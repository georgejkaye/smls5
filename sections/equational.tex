\section{Algebraic semantics}

\begin{frame}
    \frametitle{Still takes a while}

    \centering
    \LARGE

    This is a \alert{superexponential} upper bound for \\
    testing circuit equivalence

    \vspace{1em}
    \await
    Can we do better?

\end{frame}

\begin{frame}
    \frametitle{Efficiency is everything}

    \await

    \centering
    \scalebox{4}{\textbf{Algebraic}}

    \scalebox{4}{\textbf{semantics}}

\end{frame}
\begin{frame}
    \frametitle{Mealy is so back}
    \centering

    \Large
    First things first...

    \normalsize
    \await
    \begin{gather*}
        \dsptikzfig{strings/structure/monoid/unitality-l-lhs}
        =
        \dsptikzfig{strings/structure/monoid/unitality-l-rhs}
        \quad
        \dsptikzfig{strings/structure/monoid/unitality-r-lhs}
        =
        \dsptikzfig{strings/structure/monoid/unitality-r-rhs}
        \\[0.25em]
        \rule{\textwidth}{0.1mm}
        \\[0.5em]
        \dsptikzfig{circuits/axioms/bottom-delay-lhs}
        =
        \dsptikzfig{circuits/axioms/bottom-delay-rhs}
        \quad
        \dsptikzfig{circuits/instant-feedback/equation-lhs}
        =
        \dsptikzfig{circuits/instant-feedback/fixpoint-concrete}
    \end{gather*}

    \Large
    By these equations, \(
    \dsptikzfig{strings/category/f}[box=F,colour=seq]
    =
    \dsptikzfig{circuits/productivity/mealy-form}
    \)

\end{frame}
\begin{frame}
    \frametitle{It's completely normal}

    \centering
    \LARGE

    \await

    Say we have a procedure \(\lvert-\rvert\) for
    establishing a \alert{canonical circuit} for a function
    \(\morph{f}{\valuetuple{m}}{\valuetuple{n}}\)

    \await

    \vspace{1em}

    A circuit is \alert{normalised} if it is in the image of \(\lvert-\rvert\)

    \await

    \vspace{1em}

    What equations are needed to \\ normalise any circuit?

\end{frame}
\begin{frame}
    \frametitle{It's completely normal}

    \centering

    \vspace{1em}

    \begin{minipage}{0.4\textwidth}
        \centering
        \scalebox{0.6}{
            \(
            \dsptikzfig{circuits/axioms/belnap/translation/explosion-lhs}
            =
            \dsptikzfig{circuits/axioms/belnap/translation/explosion-rhs}
            \)
        }
    \end{minipage}
    \begin{minipage}{0.55\textwidth}
        \centering
        \scalebox{0.6}{
            \(
            \dsptikzfig{circuits/axioms/belnap/translation/join-and-lhs}
            =
            \dsptikzfig{circuits/axioms/belnap/translation/join-and-rhs}
            \)
            \quad
            \(
            \dsptikzfig{circuits/axioms/belnap/translation/de-morgan-and-lhs}
            =
            \dsptikzfig{circuits/axioms/belnap/translation/de-morgan-and-rhs}
            \)
        }
        \\[0.25em]
        \rule{\textwidth}{0.1mm}
        \\[0.5em]
        \scalebox{0.6}{
            \(
            \dsptikzfig{circuits/axioms/belnap/translation/join-or-lhs}
            =
            \dsptikzfig{circuits/axioms/belnap/translation/join-or-rhs}
            \)
            \quad
            \(
            \dsptikzfig{circuits/axioms/belnap/translation/de-morgan-or-lhs}
            =
            \dsptikzfig{circuits/axioms/belnap/translation/de-morgan-or-rhs}
            \)
        }
    \end{minipage}
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{
        \(\dsptikzfig{circuits/axioms/belnap/translation/not-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/not-fork-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/and-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/and-fork-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/or-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/or-fork-rhs}\)
        \quad
        \(\dsptikzfig{strings/structure/bialgebra/merge-copy-lhs}
        =
        \dsptikzfig{strings/structure/bialgebra/merge-copy-rhs}\)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{
        \(\dsptikzfig{strings/structure/bialgebra/init-copy-lhs}
        =
        \dsptikzfig{strings/structure/bialgebra/init-copy-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/and-and-idempotent-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/and-and-idempotent-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/or-or-idempotent-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/or-or-idempotent-rhs}\)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{
        \(\dsptikzfig{circuits/axioms/belnap/translation/bot-and-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/bot-x-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/bot-or-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/bot-x-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/translation/bot-and-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/bot-x-rhs}\)
        \quad
        \(\dsptikzfig{circuits/axioms/belnap/double-negation-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/double-negation-rhs}\)
    }
\end{frame}

\begin{frame}
    \frametitle{It's completely normal}
    \centering

    \vspace{1em}

    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/belnap/and-associativity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/and-associativity-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/or-associativity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/or-associativity-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/and-commutativity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/and-commutativity-rhs}
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/belnap/and-or-distributivity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/and-or-distributivity-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/or-and-distributivity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/or-and-distributivity-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/or-commutativity-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/or-commutativity-rhs}
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/belnap/absorption-2-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/absorption-2-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/absorption-1-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/absorption-1-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/or-idempotent-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/or-idempotent-rhs}
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/belnap/translation/and-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/and-fork-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/translation/or-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/translation/or-fork-rhs}
        \quad
        \dsptikzfig{circuits/axioms/belnap/and-idempotent-lhs}
        =
        \dsptikzfig{circuits/axioms/belnap/and-idempotent-rhs}
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{strings/structure/comonoid/commutativity-rhs}
        =
        \dsptikzfig{strings/structure/comonoid/commutativity-lhs}
        \quad
        \dsptikzfig{strings/structure/comonoid/associativity-lhs}
        =
        \dsptikzfig{strings/structure/comonoid/associativity-rhs}
        \quad
        \dsptikzfig{strings/structure/comonoid/unitality-l-lhs}
        =
        \dsptikzfig{strings/structure/comonoid/unitality-l-rhs}
        \)
    }
\end{frame}
\begin{frame}
    \frametitle{Changing the states}

    \centering
    \Large

    How to translate between \(
    \dsptikzfig{circuits/productivity/mealy-form}[core=|f|, colour=comb]
    \)
    and \(
    \dsptikzfig{circuits/productivity/mealy-form}[core=|g|, state=\listvar{t}, colour=comb]
    \)?

    \await

    \vspace{1em}

    First \alert{encode} one set of states into the other

    \vspace{0.5em}

    \(
    \dsptikzfig{circuits/algebraic/encoder-applied}[state=\listvar{s}]
    =
    \dsptikzfig{circuits/components/values/vs}[val=\listvar{t}]
    \qquad
    \dsptikzfig{circuits/algebraic/decoder-applied}[state=\listvar{t}]
    =
    \dsptikzfig{circuits/components/values/vs}[val=\listvar{s}]
    \)

    \vspace{1em}
    \normalsize
    (and for any future states)

\end{frame}
\begin{frame}
    \frametitle{Changing the states}

    \centering

    \vspace{1em}

    \scalebox{0.7}{\(
        \dsptikzfig{circuits/productivity/mealy-form}[core=|f|,delay=x, colour=seq]
        =
        \dsptikzfig{circuits/algebraic/state-encoding}[core=|f|,delay=x]
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/gate-lhs}
        =
        \dsptikzfig{circuits/axioms/gate-rhs}
        \quad
        \dsptikzfig{circuits/axioms/fork-lhs}
        =
        \dsptikzfig{circuits/axioms/fork-rhs}
        \quad
        \dsptikzfig{circuits/axioms/join-lhs}
        =
        \dsptikzfig{circuits/axioms/join-rhs}
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{circuits/axioms/stub-lhs}
        =
        \dsptikzfig{strings/monoidal/empty}
        \quad
        \dsptikzfig{circuits/axioms/delay-fork-lhs}
        =
        \dsptikzfig{circuits/axioms/delay-fork-rhs}
        \quad
        \dsptikzfig{circuits/axioms/bottom-delay-lhs}
        =
        \dsptikzfig{circuits/axioms/bottom-delay-rhs}
        \quad
        \dsptikzfig{circuits/axioms/streaming-lhs}
        =
        \dsptikzfig{circuits/axioms/streaming-rhs}[gate=p]
        \)
    }
    \\[0.25em]
    \rule{\textwidth}{0.1mm}
    \\[0.5em]
    \scalebox{0.7}{\(
        \dsptikzfig{strings/structure/comonoid/unitality-l-lhs}
        =
        \dsptikzfig{strings/structure/comonoid/unitality-l-rhs}
        \quad
        \dsptikzfig{strings/structure/monoid/associativity-lhs}
        =
        \dsptikzfig{strings/structure/monoid/associativity-rhs}
        \quad
        \dsptikzfig{strings/structure/monoid/commutativity-lhs}
        =
        \dsptikzfig{strings/structure/monoid/commutativity-rhs}
        \quad
        \dsptikzfig{strings/structure/bialgebra/merge-copy-lhs}
        =
        \dsptikzfig{strings/structure/bialgebra/merge-copy-rhs}
        \)
    }
\end{frame}
\begin{frame}
    \frametitle{Changing the states}

    \centering

    \LARGE
    With these equations we can derive

    \vspace{1em}

    \(
    \dsptikzfig{circuits/productivity/mealy-form}[core=|f|, colour=seq]
    =
    \dsptikzfig{circuits/algebraic/state-encoded}[core=|f|,state=\listvar{s}]
    \)


\end{frame}
\begin{frame}
    \frametitle{Think about what matters}

    \centering
    \LARGE
    Is this enough?
    \await
    \normalsize

    \vspace{1em}

    \dsptikzfig{circuits/examples/state-change/circuit-simpler-mealy}
    \quad
    \dsptikzfig{circuits/examples/state-change/circuit-mealy}

    \vspace{1em}
    \Large
    The cores may \alert{not} have the same semantics!

\end{frame}
\begin{frame}
    \frametitle{Think about what matters}

    \centering

    \(
    \dsptikzfig{circuits/productivity/mealy-form}[core=|f|]
    =
    \dsptikzfig{circuits/productivity/mealy-form}[core=|g|]
    \)

    \vspace{1em}

    \Large
    where \(f\) and \(g\) `agree on the states that matter'

\end{frame}

\begin{frame}
    \frametitle{It is complete}

    \centering
    \Large
    By the completeness of the denotational semantics, each stream function
    has a corresponding \alert{encoded} circuit...

    \await
    \vspace{1em}

    \begin{theorem}
        \centering
        Two circuits are equal by the equations if and only if they are
        denotationally equal.
    \end{theorem}

    \await

    \LARGE
    Sound and complete \alert{algebraic semantics}!

\end{frame}